---
  // Componente de Login SÓLO con inicio de sesión (Supabase)
---

<section class="min-h-screen bg-gradient-to-br from-orange-50 via-yellow-50 to-white flex items-center justify-center py-12">
  <div class="container mx-auto px-4 max-w-md">
    <!-- Logo y título -->
    <div class="text-center mb-8">
      <img src="/logo.svg" alt="Logo" class="w-20 h-20 mx-auto mb-4">
      <h1 class="text-3xl font-bold text-teal-800">Bienvenido</h1>
      <p class="text-teal-600">Inicia sesión para continuar</p>
    </div>

    <div class="bg-white rounded-2xl shadow-xl p-8">
      <!-- Formulario de Login -->
      <form id="login-form" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-teal-700 mb-2">Email</label>
          <input type="email" id="login-email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
        </div>
        <div>
          <label class="block text-sm font-medium text-teal-700 mb-2">Contraseña</label>
          <input type="password" id="login-password" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
        </div>
        <button type="submit" class="w-full bg-gradient-to-r from-orange-400 to-orange-500 hover:from-orange-500 hover:to-orange-600 text-white py-3 rounded-lg font-semibold text-lg transition-all duration-300">
          Iniciar Sesión
        </button>
      </form>
      <!-- Mensaje de estado -->
      <div id="message" class="mt-4 p-3 rounded-lg hidden"></div>
    </div>
  </div>
</section>

<script>
import { authService, userService } from '../lib/database.js';

document.addEventListener('DOMContentLoaded', async () => {
  const loginForm = document.getElementById('login-form');
  const message = document.getElementById('message');

  // Función para mostrar mensajes
  function showMessage(text, type = 'success') {
    message.textContent = text;
    message.className = `mt-4 p-3 rounded-lg ${type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;
    message.classList.remove('hidden');
  }

  // Login
  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;

    try {
      showMessage('Iniciando sesión...', 'success');
      const { user } = await authService.signIn(email, password);
      
      if (user) {
        // Guardar información del usuario en localStorage para compatibilidad
        const userInfo = {
          id: user.id,
          email: user.email,
          name: user.user_metadata?.name || user.email,
          isAdmin: false
        };
        
        // Verificar si es admin
        try {
          const userProfile = await userService.getUserById(user.id);
          if (userProfile && userProfile.is_admin) {
            userInfo.isAdmin = true;
          }
        } catch (error) {
          console.log('Usuario no encontrado en tabla users');
        }
        
        localStorage.setItem('currentUser', JSON.stringify(userInfo));
        
        showMessage('¡Inicio de sesión exitoso!', 'success');
        setTimeout(() => {
          window.location.href = '/admin';
        }, 1500);
      }
    } catch (error) {
      console.error('Error de login:', error);
      showMessage(error.message || 'Error al iniciar sesión', 'error');
    }
  });
});
</script>